var driver=driver||{};driver.util={toHex:function(a){for(var b=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),c="",d=!0,e=32;e>0;){e-=4;var f=15&a>>e;d&&0==f||(d=!1,c+=b[f])}return""==c?"0":c}},driver.params={id_selector:"driver",device:"",devicePath:"",keyId:"",EnhanceKey:"",readKeyHigh:"FFFFFFFF",readKeyLow:"FFFFFFFF",writeKeyHigh:"FFFFFFFF",writeKeyLow:"FFFFFFFF"},driver.method={existsDriver:function(a){a&&(driver.params.id_selector=a);try{document.getElementById(driver.params.id_selector).FindPort(0)}catch(b){return!1}return!0},findUkey:function(){return driver.params.device=navigator.userAgent.indexOf("MSIE")>0&&!navigator.userAgent.indexOf("opera")>-1?new ActiveXObject("Syunew3A.s_simnew3"):document.getElementById(driver.params.id_selector),0!=driver.params.device.LastError?"-1":(keyid=driver.util.toHex(driver.params.device.GetID_1(driver.params.devicePath))+driver.util.toHex(driver.params.device.GetID_2(driver.params.devicePath)),0!=driver.params.device.LastError?"0":(driver.params.keyId=keyid,1))},writeBinary:function(a,b){var c=b.length;if("string"!=typeof b)throw new TypeError("\u53c2\u6570\u7c7b\u578b\u5e94\u8be5\u4e3a\u5b57\u7b26\u4e32");for(var d=0;c>d;d++)driver.params.device.SetBuf(b.charCodeAt(d),d);return 0!=driver.params.device.YWriteEx(a,c,driver.params.writeKeyHigh,driver.params.writeKeyLow,driver.params.devicePath)?!1:!0},readBinary:function(a,b){if(0!=driver.params.device.YReadEx(a,b,driver.params.readKeyHigh,driver.params.readKeyLow,driver.params.devicePath))return!1;for(var c="",d=0;b>d;d++)c+=String.fromCharCode(driver.params.device.GetBuf(d));return c},setEnhanceKey:function(a){var b=driver.params.device.SetCal_2(a,driver.params.devicePath);return 0!=b?!1:(driver.params.EnhanceKey=a,!0)},encryptString:function(a){var b=driver.params.device.EncString(a,driver.params.devicePath);return 0!=driver.params.device.LastError?!1:b},unEncryptString:function(a){var b=driver.params.device.DecString(a,driver.params.EnhanceKey);return 0!=driver.params.device.LastError?!1:b},encryptBinary:function(a){for(var c,d,b=a.length,e=0;b>e;e++)driver.params.device.SetEncBuf(a[e],e);if(d=driver.params.device.Cal(driver.params.devicePath),0!=d)return!1;for(var e=0;b>e;e++)c=c+driver.params.device.GetEncBuf(e)+",";return c},writeString:function(a){var b=driver.params.device.YWriteString(a,1,driver.params.writeKeyHigh,driver.params.writeKeyLow,driver.params.devicePath);if(0!=driver.params.device.LastError)return-1;driver.params.device.SetBuf(b,0);var c=driver.params.device.YWriteEx(0,1,driver.params.writeKeyHigh,driver.params.writeKeyLow,driver.params.devicePath);return 0!=c?0:1},readString:function(){var a=driver.params.device.YReadEx(0,1,driver.params.readKeyHigh,driver.params.readKeyLow,driver.params.devicePath),b=driver.params.device.GetBuf(0);if(0!=a)return!1;var c=driver.params.device.YReadString(1,b,driver.params.readKeyHigh,driver.params.readKeyLow,driver.params.devicePath);return 0!=driver.params.device.LastError?!1:c},reset:function(){var a=driver.params.device.ReSet(driver.params.devicePath);return 0!=a?!1:!0},setWritePassword:function(a,b){var c=driver.params.device.SetWritePassword(driver.params.writeKeyHigh,driver.params.writeKeyLow,a,b,driver.params.devicePath);return 0!=c?!1:(driver.params.writeKeyHigh=a,driver.params.writeKeyLow=b,!0)},setReadPassword:function(a,b){var c=driver.params.device.SetReadPassword(driver.params.readKeyHigh,driver.params.readKeyLow,a,b,driver.params.devicePath);return 0!=c?!1:(driver.params.readKeyHigh=a,driver.params.readKeyLow=b,!0)}};